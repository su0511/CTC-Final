<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hesse's Mirror - The Samanas</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #333; /* 深灰色背景 */
      color: #ccc; /* 浅灰色文字 */
      font-family: 'EB Garamond', serif;
      overflow: hidden;
      cursor: none; /* Hide default cursor */
    }

    canvas {
      display: block;
      position: absolute;
      z-index: 0;
    }

    .text-layer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 2;
    }

    .fragment {
      position: absolute;
      font-size: 0.8rem;
      padding: 0.5rem 0.8rem;
      background: rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(2px);
      opacity: 0;
      transition: all 0.3s ease;
      white-space: nowrap;
      max-width: 150px;
    }

    .fragment.visible {
      opacity: 1;
    }

    #page-transition-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #333; /* 与背景色一致 */
      opacity: 0;
      z-index: 9999;
      transition: opacity 0.5s ease-in-out;
      pointer-events: none;
    }

    body.fade-out #page-transition-overlay {
      opacity: 1;
    }
  </style>
</head>
<body>
  <div class="text-layer"></div>
  <div id="page-transition-overlay"></div>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.4.2/lib/p5.min.js"></script>
  <script>
    let shards = [];
    const texts = [
      "He learned to let his self merge into the thousand other selves...",
      "He saw that this self, this opinion, this narrow heart, this brittle shell had to be shattered.",
      "He found no peace.",
      "He asked himself whether this feverish mood was what he called the 'self'.",
      "Was he not in truth nothing but a single, narrow trail of a thought?",
      "Did not the secret of Siddhartha lie in the word 'Om'?"
    ];

    let dotX;
    let dotY;
    let easing = 0.1;
    let stuckInShard = null;
    let touchEdgeCount = 0;
    const exitTouchThreshold = 3;
    let dotSpeedX = 0;
    let dotSpeedY = 0;
    const friction = 0.9;
    let isTransitioning = false;
    const transitionDuration = 500;

    function setup() {
      createCanvas(windowWidth, windowHeight);
      noFill();
      stroke(100);
      let textLayer = document.querySelector('.text-layer');
      for (let i = 0; i < texts.length; i++) {
        let shard = {
          x: random(width),
          y: random(height),
          baseY: 0,
          r: random(20, 50),
          entered: false,
          offset: random(1000),
          fragment: document.createElement('div')
        };
        shard.fragment.classList.add('fragment');
        shard.fragment.innerHTML = texts[i];
        textLayer.appendChild(shard.fragment);
        shards.push(shard);
      }

      dotX = width / 2;
      dotY = height / 2;
    }

    function draw() {
      clear();
      background(50);

      let t = millis() / 1000;
      for (let i = 0; i < shards.length; i++) {
        const s = shards[i];
        s.baseY = 10 * sin(t * 0.8 + s.offset);
        strokeWeight(s.entered ? 1 : 0.5);
        fill(s.entered ? color(200, 200, 200, 20) : color(0, 0, 0, 0));
        stroke(100);
        ellipse(s.x + cos(t * 0.5 + s.offset) * 10, s.y + s.baseY + sin(t * 0.5 + s.offset) * 10, s.r * 0.8);

        const fragment = s.fragment;
        fragment.classList.toggle('visible', s.entered);

        if (s.entered) {
          let fragmentX = s.x + 15;
          let fragmentY = s.y + s.baseY - 5;

          const fragmentWidth = fragment.offsetWidth;
          const fragmentHeight = fragment.offsetHeight;

          if (fragmentX + fragmentWidth > width) {
            fragmentX = s.x - fragmentWidth - 15;
          }
          if (fragmentY + fragmentHeight > height) {
            fragmentY = s.y + s.baseY - fragmentHeight + 5;
          }
          if (fragmentY < 0) {
            fragmentY = s.y + s.baseY + 15;
          }

          fragment.style.left = fragmentX + 'px';
          fragment.style.top = fragmentY + 'px';
        }

        if (stuckInShard === i) {
          dotX += dotSpeedX;
          dotY += dotSpeedY;
          dotSpeedX *= friction;
          dotSpeedY *= friction;

          const d = dist(dotX, dotY, s.x, s.y + s.baseY);
          if (d > s.r * 0.4) {
            touchEdgeCount++;
          } else if (d < s.r * 0.2) {
            touchEdgeCount = 0;
          }

          if (touchEdgeCount >= exitTouchThreshold && !mouseIsPressed && !isTransitioning) {
            shards[stuckInShard].entered = false;
            stuckInShard = null;
            touchEdgeCount = 0;
            dotSpeedX = 0;
            dotSpeedY = 0;
            document.body.classList.add('fade-out');
            setTimeout(() => {
              window.location.href = '../page3/index.html';
            }, transitionDuration);
          }
        }
      }

      if (stuckInShard === null) {
        let targetX = mouseX;
        let dx = targetX - dotX;
        dotX += dx * easing;

        let targetY = mouseY;
        let dy = targetY - dotY;
        dotY += dy * easing;
        dotSpeedX = 0;
        dotSpeedY = 0;

        // Check for transition back to page 1
        if (dotX < 20 && !mouseIsPressed && !isTransitioning) {
          isTransitioning = true;
          document.body.classList.add('fade-out');
          setTimeout(() => {
            window.location.href = '../index.html';
          }, transitionDuration);
        }
      }

      fill(200);
      noStroke();
      ellipse(dotX, dotY, 6, 6);

      if (stuckInShard === null) {
        for (let i = 0; i < shards.length; i++) {
          const s = shards[i];
          const d = dist(dotX, dotY, s.x, s.y + s.baseY);
          if (d < s.r / 2) {
            stuckInShard = i;
            shards[i].entered = true;
            touchEdgeCount = 0;
            dotSpeedX = 0;
            dotSpeedY = 0;
            break

      